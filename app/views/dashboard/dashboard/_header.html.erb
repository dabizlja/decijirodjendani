<%
  header_title = local_assigns.fetch(:title) { "Dobrodo≈°li, #{current_user.full_name.split.first}! üëã" }
  header_subtitle = local_assigns.fetch(:subtitle) { "Upravljajte svojim biznisom i pratite performanse na jednom mestu" }
  back_link_path = local_assigns[:back_link_path]
  back_link_label = local_assigns.fetch(:back_link_label, "Nazad")
  content_width = local_assigns.fetch(:content_width, "max-w-6xl")
%>

<div class="bg-gradient-to-br from-purple-300 via-pink-300 to-red-300 text-white relative overflow-visible min-h-[300px] z-40"
     style="background: linear-gradient(135deg, rgba(147, 51, 234, 0.8) 0%, rgba(236, 72, 153, 0.8) 50%, rgba(239, 68, 68, 0.8) 100%);">
  <!-- Decorative elements -->
  <div class="hidden md:block absolute top-8 left-8 text-2xl opacity-30">üéØ</div>
  <div class="hidden md:block absolute top-12 right-12 text-2xl opacity-30">üìä</div>
  <div class="hidden md:block absolute bottom-8 left-12 text-2xl opacity-30">üíº</div>
  <div class="hidden md:block absolute bottom-12 right-8 text-2xl opacity-30">üöÄ</div>

  <!-- Navigation Bar -->
  <div class="relative z-50 flex justify-between items-center p-6">
    <div class="flex items-center gap-4">
      <%= link_to root_path, class: "flex items-center transition hover:opacity-90" do %>
        <%= image_tag "logo.png", alt: "Roƒëendani Logo", class: "h-16 w-auto sm:h-24" %>
      <% end %>

      <% if back_link_path.present? %>
        <%= link_to back_link_path, class: "flex items-center gap-2 text-white hover:opacity-90 transition ml-4" do %>
          <span class="text-xl">‚Üê</span>
          <span class="font-medium"><%= back_link_label %></span>
        <% end %>
      <% end %>
    </div>

    <div class="flex items-center gap-3 rounded-full border border-white/30 bg-white/15 px-3 py-2 text-white shadow-xl backdrop-blur-lg sm:px-5 sm:py-2.5">
      <% if user_signed_in? %>
        <div class="relative z-50" data-dropdown>
          <button type="button"
                  class="group flex items-center gap-2 rounded-full bg-white/20 px-2 py-1 text-sm font-medium text-white transition hover:bg-white/30 focus:outline-none focus:ring-2 focus:ring-white/60"
                  data-dropdown-toggle>
            <% avatar_url = current_user.avatar_url.presence %>
            <% initials = current_user.full_name.to_s.strip.first&.upcase || "U" %>
            <% if avatar_url.present? %>
              <img src="<%= avatar_url %>"
                   alt="<%= current_user.full_name %>"
                   class="h-9 w-9 rounded-full object-cover ring-2 ring-white/60" />
            <% else %>
              <div class="flex h-9 w-9 items-center justify-center rounded-full bg-gradient-to-br from-purple-500 to-pink-500 text-sm font-semibold text-white ring-2 ring-white/60">
                <%= initials %>
              </div>
            <% end %>
            <span class="hidden text-sm font-semibold sm:inline"><%= current_user.full_name.split.first %></span>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-white/80 transition group-hover:text-white" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 10.939l3.71-3.71a.75.75 0 111.06 1.061l-4.24 4.24a.75.75 0 01-1.06 0L5.25 8.27a.75.75 0 01-.02-1.06z" clip-rule="evenodd" />
            </svg>
          </button>

          <div class="absolute right-0 top-full z-[999] mt-2 w-60 origin-top-right rounded-3xl bg-white p-4 shadow-2xl ring-1 ring-black/5 backdrop-blur-lg hidden"
               data-dropdown-menu>
            <div class="mb-4 rounded-2xl bg-gradient-to-r from-purple-50 to-pink-50 p-4 border border-purple-100">
              <p class="text-sm font-semibold text-purple-900"><%= current_user.full_name %></p>
              <p class="text-xs text-purple-600 truncate"><%= current_user.email %></p>
            </div>
            <div class="space-y-3">
              <%= link_to "üè† Moja kontrolna tabla", dashboard_root_path, class: "flex items-center gap-2 rounded-2xl px-4 py-3 text-sm font-medium text-gray-700 transition hover:bg-gradient-to-r hover:from-purple-50 hover:to-pink-50 hover:text-purple-800 border border-gray-100 hover:border-purple-200" %>
              <% unread_total = @unread_messages_count.to_i %>
              <%= link_to dashboard_conversations_path, class: "relative flex items-center gap-2 rounded-2xl px-4 py-3 text-sm font-medium text-gray-700 transition hover:bg-gradient-to-r hover:from-purple-50 hover:to-pink-50 hover:text-purple-800 border border-gray-100 hover:border-purple-200" do %>
                üí¨ Poruke
                <span data-unread-badge
                      class="ml-auto inline-flex items-center justify-center h-5 min-w-[1.5rem] rounded-full bg-red-500 px-2 text-[11px] font-semibold text-white leading-none tracking-tight <%= 'hidden' if unread_total.zero? %>">
                  <span data-unread-count><%= unread_total %></span>
                </span>
              <% end %>
              <%= button_to "üö™ Odjavi se",
                            destroy_user_session_path,
                            method: :delete,
                            class: "w-full rounded-2xl bg-purple-600 text-white px-4 py-3 text-sm font-medium hover:bg-purple-700 transition-colors" %>
            </div>
          </div>
        </div>
      <% else %>
        <div class="flex justify-end">
          <button type="button"
                  data-modal-target="sign-in-modal"
                  data-modal-toggle="sign-in-modal"
                  class="flex items-center gap-2 rounded-full border border-white/40 bg-white/10 px-4 py-1.5 text-xs font-medium text-white transition hover:bg-white/20 hover:shadow-lg sm:text-sm">
            üîë Prijavi se
          </button>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Header Title -->
  <div class="relative z-10 pb-8">
    <div class="<%= content_width %> mx-auto px-6">
      <h1 class="text-3xl md:text-4xl font-bold text-white mb-4">
        <%= header_title %>
      </h1>
      <% if header_subtitle.present? %>
        <p class="text-white/90 text-lg">
          <%= header_subtitle %>
        </p>
      <% end %>
    </div>
  </div>
</div>
